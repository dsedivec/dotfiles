# Things to remember:
#
# - prefix + [: copy mode
# - prefix + ]: paste
# - prefix + Z: zoom
# - prefix + q: show pane indexes and switch
# - prefix + C: create new session
# - prefix + !: pane to window
# - prefix + @: window to session
# - prefix + E: balance pane and any touching panes
# - prefix + M-1 through 5: select different layouts
# - prefix + /: copycat regexp search, n/N for next/prev
# - prefix + C-f: file search
# - prefix + M-h: jump over SHA-1/SHA256 hashes
# - prefix + C-u: URL search
# - prefix + C-d: number search
# - prefix + M-i: IP address search
# - copy-mode o: "open" selection
# - copy-mode C-o: open selection with $EDITOR
# - copy-mode S: search selection with Google
# - prefix + hjkl or M-arrow: move panes
# - prefix + C-hjkl: resize panes
# - prefix + C-\ _: split full width horizontal/vertical
# - Show options: show -g, show -A
# - Rename pane: select-pane -T <new name> (WTF)
# - Undo select-layout: select-layout -o
#
# References:
#
# https://github.com/rothgar/awesome-tmux
# https://tmuxcheatsheet.com/
# https://www.hamvocke.com/blog/a-guide-to-customizing-your-tmux-conf/
# https://www.barbarianmeetscoding.com/blog/2019/12/25/jaimes-guide-to-tmux-the-most-awesome-tool-you-didnt-know-you-needed

set -g default-terminal "screen-256color"
set -g alternate-screen off
set -g mode-keys emacs
set -g status-keys emacs
# Nice because it lets you scroll back with the mouse wheel.  Also, resize
# panes with mouse.
set -g mouse on
# Don't try to use escape codes to manipulate the system clipboard.  I have
# that shit turned off---seems rather hazardous.
set -g set-clipboard off
# Switch to latest session when killing the last member of the current
# session, instead of just detaching the client.
set -g detach-on-destroy off
# Allow terminal to rename panes.
set -g allow-rename on
# Automatic window naming, includes process name.
set -g automatic-rename on

%if "#{||:#{!=:#{client_control_mode},1},#{!=:#{TERM_PROGRAM},iTerm.app}}"
set -g aggressive-resize on
%endif

set -g pane-active-border-style "fg=white,bg=blue"
set -g pane-border-status off
# Only show pane border if there is >1 pane.  This is adapted from
# https://github.com/tmux/tmux/issues/566#issuecomment-346734415 using
# the following comment to (supposedly?) avoid starting a shell
# process.
set-hook -g 'after-new-window' "if-shell -F '#{==:#{window_panes},1}' 'set -w pane-border-status off' 'set -w pane-border-status bottom'"
set-hook -g 'after-kill-pane' "if-shell -F '#{==:#{window_panes},1}' 'set -w pane-border-status off' 'set -w pane-border-status bottom'"
set-hook -g 'pane-exited' "if-shell -F '#{==:#{window_panes},1}' 'set -w pane-border-status off' 'set -w pane-border-status bottom'"
set-hook -g 'after-split-window' "if-shell -F '#{==:#{window_panes},1}' 'set -w pane-border-status off' 'set -w pane-border-status bottom'"
set-hook -g 'after-resize-pane'  "if-shell -F '#{||:#{==:#{window_panes},1},#{window_zoomed_flag}}' 'set -w pane-border-status off' 'set -w pane-border-status bottom'"

# https://github.com/tmux-plugins/tmux-sensible
set -g history-limit 50000
set -g display-time 4000

# set -g prefix "C-o"
# bind o send-prefix
# bind C-o last-window

set -g prefix "`"
bind ` send-prefix

bind r source-file ~/.tmux.conf

# <S-prior> to enter copy mode and let you scroll around.  NOTE: in iTerm2 you
# will need to enable "CSI u" sequences.
bind -n S-PPage copy-mode -eu
bind -T copy-mode S-PPage send-keys -X page-up
bind -T copy-mode S-NPage send-keys -X page-down

# <S-end> will also exit scrollback.
bind -T copy-mode S-End send-keys Escape
# <S-home> should then go to beginning of scrollback.
bind -T copy-mode S-Home send-keys -X history-top

# Don't reuse the last search in incremental search (more like Emacs).
bind -T copy-mode C-r command-prompt -i -p "(search up)" "send -X search-backward-incremental \"%%%\""
bind -T copy-mode C-s command-prompt -i -p "(search down)" "send -X search-forward-incremental \"%%%\""

# Switch panes using alt-arrow without prefix.  Courtesy
# https://www.hamvocke.com/blog/a-guide-to-customizing-your-tmux-conf/.
# See also tmux-pain-control plug-in.
bind -n M-Left select-pane -L
bind -n M-Right select-pane -R
bind -n M-Up select-pane -U
bind -n M-Down select-pane -D

# tmux-pain-control clobbers prefix+l for last-window.
bind a last-window


## Status related settings

# Defaults:

# status on
# status-bg* green
# status-fg* black
# status-format[0]* "#[align=left range=left #{status-left-style}]#[push-default]#{T;=/#{status-left-length}:status-left}#[pop-default]#[norange default]#[list=on align=#{status-justify}]#[list=left-marker]<#[list=right-marker]>#[list=on]#{W:#[range=window|#{window_index} #{window-status
# -style}#{?#{&&:#{window_last_flag},#{!=:#{window-status-last-style},default}}, #{window-status-last-style},}#{?#{&&:#{window_bell_flag},#{!=:#{window-status-bell-style},default}}, #{window-status-bell-style},#{?#{&&:#{||:#{window_activity_flag},#{window_silence_flag}},#{!=:#{window-sta
# tus-activity-style},default}}, #{window-status-activity-style},}}]#[push-default]#{T:window-status-format}#[pop-default]#[norange default]#{?window_end_flag,,#{window-status-separator}},#[range=window|#{window_index} list=focus #{?#{!=:#{window-status-current-style},default},#{window-s
# tatus-current-style},#{window-status-style}}#{?#{&&:#{window_last_flag},#{!=:#{window-status-last-style},default}}, #{window-status-last-style},}#{?#{&&:#{window_bell_flag},#{!=:#{window-status-bell-style},default}}, #{window-status-bell-style},#{?#{&&:#{||:#{window_activity_flag},#{wi
# ndow_silence_flag}},#{!=:#{window-status-activity-style},default}}, #{window-status-activity-style},}}]#[push-default]#{T:window-status-current-format}#[pop-default]#[norange list=on default]#{?window_end_flag,,#{window-status-separator}}}#[nolist align=right range=right #{status-right
# -style}]#[push-default]#{T;=/#{status-right-length}:status-right}#[pop-default]#[norange default]"
# status-format[1]* "#[align=centre]#{P:#{?pane_active,#[reverse],}#{pane_index}[#{pane_width}x#{pane_height}]#[default] }"
# status-interval* 15
# status-justify* left
# status-keys* emacs
# status-left* "[#S] "
# status-left-length* 10
# status-left-style* default
# status-position* bottom
# status-right* "#{?window_bigger,[#{window_offset_x}#,#{window_offset_y}] ,}\"#{=21:pane_title}\" %H:%M %d-%b-%y"
# status-right-length* 40
# status-right-style* default
# status-style* fg=black,bg=green

set -g status-left "#{prefix_highlight}[#S] "
set -g status-left-length 20
set -g @prefix_highlight_fg 'white,bold'
set -g @prefix_highlight_bg '#ff0000'
set -g @prefix_highlight_show_copy_mode 'on'
# set -g @prefix_highlight_copy_mode_attr 'fg=black,bg=yellow,bold' # default is 'fg=default,bg=yellow'
set -g @prefix_highlight_show_sync_mode 'on'
# set -g @prefix_highlight_sync_mode_attr 'fg=black,bg=green' # default is 'fg=default,bg=yellow'


## Plugins

# https://github.com/tmux-plugins/tmux-prefix-highlight
set -g @plugin 'tmux-plugins/tmux-prefix-highlight'
# https://github.com/tmux-plugins/tmux-copycat
set -g @plugin 'tmux-plugins/tmux-copycat'
# https://github.com/tmux-plugins/tmux-yank
set -g @plugin 'tmux-plugins/tmux-yank'
# https://github.com/tmux-plugins/tmux-open
set -g @plugin 'tmux-plugins/tmux-open'
# https://github.com/tmux-plugins/tmux-continuum
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
# https://github.com/tmux-plugins/tmux-sessionist
set -g @plugin 'tmux-plugins/tmux-sessionist'
# https://github.com/tmux-plugins/tmux-pain-control
set -g @plugin 'tmux-plugins/tmux-pain-control'

# Initialize TMUX plugin manager (keep this line at the very bottom of
# tmux.conf)
run -b '~/.tmux/plugins/tpm/tpm'
